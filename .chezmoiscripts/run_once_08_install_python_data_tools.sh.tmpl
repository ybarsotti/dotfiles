#!/bin/bash

# run_once_08_install_python_data_tools.sh.tmpl
#
# This script installs Python data science and machine learning tools via pipx
# These tools are installed in isolated environments to avoid dependency conflicts

{{ template "error_handling" }}

echo "Installing Python data science and ML tools via pipx..."

# Check if pipx is available
if ! command -v pipx &>/dev/null; then
    echo "‚ö†Ô∏è  pipx not found. Please install pipx first."
    echo "Run: brew install pipx"
    exit 1
fi

# Ensure pipx path is set up
pipx ensurepath &>/dev/null || true

# Array of Python tools to install
python_tools=(
    # Jupyter Ecosystem
    "jupyterlab"
    "jupytext"
    "nbconvert"
    "nbdime"
    "ipython"

    # ML & Data Engineering
    "dvc"
    "mlflow"
    "great-expectations"

    # CLI Tools
    "polars-cli"
)

{{- if eq .machine.purpose "personal" }}
# Personal-only Python tools
python_tools+=(
    "open-webui"
)
{{- end }}

# Install each tool
for tool in "${python_tools[@]}"; do
    if pipx list 2>/dev/null | grep -q "package $tool"; then
        echo "‚úì $tool is already installed"
    else
        echo "Installing $tool..."
        if pipx install "$tool" 2>/dev/null; then
            echo "‚úì Successfully installed $tool"
        else
            echo "‚úó Failed to install $tool (continuing...)"
        fi
    fi
done

echo ""
echo "Python data science tools installation complete!"
echo ""
echo "Installed tools:"
echo "  üìä Jupyter: jupyterlab, jupytext, nbconvert, nbdime, ipython"
echo "  ü§ñ MLOps: dvc, mlflow, great-expectations"
echo "  ‚ö° CLI: polars-cli"
{{ if eq .machine.purpose "personal" -}}
echo "  üåê AI: open-webui (run: open-webui serve)"
{{- end }}
echo ""
echo "Quick start:"
echo "  ‚Ä¢ Launch JupyterLab: jupyter lab"
echo "  ‚Ä¢ Initialize DVC: dvc init"
echo "  ‚Ä¢ Start MLflow UI: mlflow ui"
echo "  ‚Ä¢ Interactive Python: ipython"
echo ""
echo "Note: You may need to restart your shell for PATH changes to take effect."
